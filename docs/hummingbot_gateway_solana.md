# Використання Hummingbot Gateway для тестів на Solana Devnet

Цей документ надає відповіді на поширені запитання щодо налаштування та використання Hummingbot Gateway для тестування на Solana Devnet, зокрема у контексті взаємодії з Pool Indexer.

## 1. Конфігурація Solana Devnet

### Як налаштовано Solana RPC у Gateway (який endpoint, чи є fallback)?

Solana RPC в Gateway налаштовується через конфігураційні файли.

-   **Endpoint:** Для Devnet, endpoint за замовчуванням вказаний у файлі `conf/chains/solana/devnet.yml`:
    ```yaml
    nodeURL: https://api.devnet.solana.com
    ```
-   **RPC Провайдер:** Gateway підтримує два типи RPC провайдерів для Solana, які налаштовуються у файлі `conf/chains/solana.yml`:
    -   `url`: Використовує `nodeURL` з конфігурації мережі (наприклад, `devnet.yml`).
    -   `helius`: Використовує RPC від Helius. Для цього потрібен API ключ, вказаний у `conf/rpc/helius.yml`.
-   **Fallback:** Якщо `rpcProvider` встановлено на `helius`, але виникає помилка при ініціалізації (наприклад, через недійсний API ключ), Gateway автоматично повертається до використання стандартного `nodeURL`.

### Чи ввімкнено Devnet у списку доступних мереж/DEX?

Так, Devnet повністю підтримується.

-   **Мережа:** `solana-devnet` зареєстровано як доступна мережа у файлі `conf/root.yml`.
-   **DEX:** Усі основні конектори для Solana (Raydium, Jupiter, Meteora) автоматично підтримують усі доступні мережі Solana, включаючи Devnet. Це налаштовано у їхніх конфігураційних файлах (наприклад, `src/connectors/raydium/raydium.config.ts`), де вони завантажують список мереж з `getAvailableSolanaNetworks()`.

## 2. Гаманці та токени

### Де зберігаються Solana-гаманці в Gateway (файл, база)?

Solana-гаманці зберігаються у вигляді зашифрованих JSON файлів.

-   **Розташування:** `conf/wallets/solana/`
-   **Формат:** Кожен гаманець зберігається в окремому файлі, назва якого відповідає публічній адресі гаманця (наприклад, `conf/wallets/solana/YourWalletAddress.json`). Вміст файлу — це зашифрований приватний ключ.

### Як перевірити баланс і токени гаманця через Gateway?

Для перевірки балансів використовується ендпоінт `/chains/solana/balances`.

-   **Endpoint:** `POST /chains/solana/balances`
-   **Запит:**
    ```json
    {
      "chain": "solana",
      "network": "devnet",
      "address": "YOUR_WALLET_ADDRESS",
      "tokens": ["SOL", "USDC"]
    }
    ```
-   **Параметри:**
    -   `address`: Адреса вашого гаманця.
    -   `network`: Мережа, наприклад `devnet`.
    -   `tokens` (опціонально): Масив символів токенів або їхніх mint-адрес. Якщо не вказано, Gateway поверне ненульові баланси для всіх відомих токенів та баланс SOL.

### Чи створюються ATA автоматично, коли додаємо токен/пул?

Так, створення асоційованих токен-акаунтів (ATA) відбувається автоматично. Gateway використовує офіційні SDK від DEX (Raydium, Meteora), які інкапсулюють логіку створення ATA. Коли ви виконуєте операцію, що потребує ATA (наприклад, обмін або додавання ліквідності), і відповідного акаунту не існує, SDK автоматично додає інструкцію для його створення в транзакцію.

## 3. Raydium Devnet підтримка

### Які типи Raydium-пулів підтримує Gateway на Devnet (AMM v4, CPMM, CLMM)?

Gateway підтримує наступні типи пулів Raydium:
-   **AMM (Automated Market Maker):** Включаючи стандартні пули (AMM v4) та пули зі стабільною кривою (Stable).
-   **CPMM (Constant Product Market Maker):** Також підтримуються.
-   **CLMM (Concentrated Liquidity Market Maker):** Повністю підтримуються через окремі ендпоінти.

Підтримка реалізована у відповідних директоріях: `src/connectors/raydium/amm-routes/` та `src/connectors/raydium/clmm-routes/`.

### Чи є обмеження на свопи (наприклад, потрібен Serum market)?

Ні, для сучасних типів пулів Raydium (AMM v4, CPMM, CLMM) **не потрібен** Serum market. Gateway використовує `raydium-sdk-v2`, який працює з новими пулами без залежності від Serum.

### Чи є готові приклади конфігу для Devnet-пулу (той самий dwSOL/test111)?

У стандартній конфігурації (`conf/pools/raydium.json`) приклади для Devnet відсутні, там наведені лише пули для `mainnet-beta`.

Однак, ви можете легко додати новий пул для Devnet, використовуючи ендпоінт `POST /pools`.

**Приклад запиту для додавання пулу:**
```json
{
  "connector": "raydium",
  "type": "amm",
  "network": "devnet",
  "baseSymbol": "dwSOL",
  "quoteSymbol": "test111",
  "address": "POOL_ADDRESS"
}
```
Вам потрібно буде знайти адресу пулу `dwSOL/test111` на Devnet і вказати її в полі `address`.

## 4. Пошук пулів

### Чи можна через API Gateway отримати список Devnet-пулів і їх параметри?

Так, але з деякими особливостями.

-   **Отримання списку налаштованих пулів:** Ви можете отримати список пулів, які додані до конфігурації Gateway, за допомогою ендпоінту `GET /pools`.
    -   **Запит:** `GET /pools?connector=raydium&network=devnet&type=amm`
    -   **Відповідь:** Поверне список пулів з базовою інформацією (`type`, `network`, `baseSymbol`, `quoteSymbol`, `address`).

-   **Динамічний пошук пулів (CLMM):** Для Raydium CLMM є ендпоінт `GET /connectors/raydium/clmm/pools`, який дозволяє динамічно завантажувати пули з Raydium API.

-   **Детальна інформація про конкретний пул:** Щоб отримати повні параметри пулу, використовуйте ендпоінти `pool-info`:
    -   `GET /connectors/raydium/amm/pool-info?poolAddress=<POOL_ID>&network=devnet`
    -   `GET /connectors/raydium/clmm/pool-info?poolAddress=<POOL_ID>&network=devnet`

### Якщо так, які поля (mintA/mintB, vaultи, програма) повертаються?

Відповідь на запит `pool-info` містить детальну інформацію про пул.

-   **AMM (`/connectors/raydium/amm/pool-info`):**
    -   `address`: Адреса пулу.
    -   `baseTokenAddress`, `quoteTokenAddress`: Mint-адреси токенів.
    -   `price`: Поточна ціна.
    -   `baseTokenAmount`, `quoteTokenAmount`: Резерви токенів у пулі.
    -   `feePct`: Відсоток комісії.

-   **CLMM (`/connectors/raydium/clmm/pool-info`):**
    -   `address`: Адреса пулу.
    -   `baseTokenAddress`, `quoteTokenAddress`: Mint-адреси токенів.
    -   `binStep`: Крок бінів (тіків).
    -   `price`: Поточна ціна.
    -   `activeBinId`: ID активного біна.
    -   та інші параметри CLMM.

Поля `vaults` та `program` напряму не повертаються у відповіді, але `programId` можна визначити за типом пулу (AMM, CPMM, CLMM), оскільки для кожного типу використовується своя програма.

### Чи можна попросити Gateway підтягти конкретний пул за poolId?

Так, це основна функція ендпоінтів `pool-info`. Ви передаєте `poolAddress` (ID пулу) як параметр запиту, і Gateway повертає повну інформацію про цей пул, навіть якщо його немає у локальному конфігураційному файлі.

-   **Приклад для AMM:**
    `GET /connectors/raydium/amm/pool-info?poolAddress=58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2&network=mainnet-beta`
-   **Приклад для CLMM:**
    `GET /connectors/raydium/clmm/pool-info?poolAddress=3ucNos4NbumPLZNWztqGHNFFgkHeRMBQAVemeeomsUxv&network=mainnet-beta`

Це дозволяє працювати з будь-яким пулом Raydium, знаючи лише його адресу.

## 5. Виконання свопів

### Які API/CLI виклики використовуються для swap на Devnet?

Для виконання свопів використовуються REST API ендпоінти. Шлях залежить від DEX та типу пулу.

-   **Jupiter (агрегатор):** `POST /connectors/jupiter/router/swap`
-   **Raydium (AMM):** `POST /connectors/raydium/amm/swap`
-   **Raydium (CLMM):** `POST /connectors/raydium/clmm/swap`
-   **Meteora (CLMM):** `POST /connectors/meteora/clmm/swap`

Усі запити є `POST` запитами і вимагають тіло з параметрами.

### Які параметри потрібні (poolId, marketId, токени, slippage, сума)?

Параметри відрізняються залежно від DEX:

-   **Jupiter:**
    -   Спочатку ви отримуєте `quote` через ендпоінт `POST /connectors/jupiter/router/quote`.
    -   Потім цей об'єкт `quote` передається в тілі запиту на `swap`.
    -   **Основні параметри для `/quote`:** `inputToken`, `outputToken`, `amount`, `slippageBps` (slippage в базисних пунктах).
    -   **Основні параметри для `/swap`:** `quote`, `walletAddress`.

-   **Raydium (AMM):**
    -   `poolId`: Адреса пулу.
    -   `ownerAddress`: Адреса вашого гаманця.
    -   `inputTokenAddress`, `outputTokenAddress`: Адреси токенів.
    -   `inputAmount`: Сума для обміну (в найменших одиницях, наприклад, lamports).
    -   `slippage`: Slippage у відсотках (наприклад, `1` для 1%).

-   **Meteora/Raydium (CLMM):**
    -   `poolAddress`: Адреса пулу.
    -   `ownerAddress`: Адреса вашого гаманця.
    -   `inputTokenAddress`: Адреса вхідного токену.
    -   `inputAmount`: Сума для обміну.
    -   `slippage`: Slippage у відсотках.

### Чи відразу повертається signature/txHash, і де її логують?

-   **Повернення txHash:** Так, після успішної відправки транзакції API відразу повертає відповідь, що містить `txHash`.
    ```json
    {
      "txHash": "5j2PC5sC362iJNAaB2gXfsh1S2L1n3a2...",
      "timestamp": 1672531200000
    }
    ```
-   **Логування:** `txHash` логується в основному файлі логів Gateway: `logs/gateway.log`. Запис має рівень `INFO` і виглядає приблизно так:
    ```
    {"level":30,"time":1672531200000,"pid":123,"hostname":"...","msg":"Transaction has been submitted. txHash: 5j2PC5sC362iJNAaB2gXfsh1S2L1n3a2..."}
    ```

### Як обробляються помилки або недостатній баланс?

Помилки обробляються на рівні API. Gateway повертає HTTP-помилку з відповідним статусом та описом.

-   **Недостатній баланс:** Solana RPC поверне помилку, яку Gateway перехопить і передасть клієнту, зазвичай зі статусом `503 Service Unavailable` або `400 Bad Request`. Тіло відповіді буде містити оригінальний текст помилки від RPC, наприклад, `"failed to send transaction: Transaction simulation failed: Error processing Instruction 0: custom program error: 0x1"` (що часто означає недостатній баланс або іншу проблему з транзакцією).
-   **Інші помилки:** Неправильні параметри (наприклад, неіснуючий пул) призведуть до помилки `400 Bad Request`.

## 6. Інтеграція з Dex ботами

### Коли створюємо DEX бота через Admin Service, як Gateway дізнається про новий гаманець/пул?

Gateway є **безстатусним (stateless) API** і не має поняття "DEX бот" або "Admin Service". Взаємодія відбувається наступним чином:

1.  **Hummingbot (клієнт):** Коли ви створюєте та налаштовуєте бота в Hummingbot, він стає клієнтом для Gateway.
2.  **Створення гаманця:** Якщо боту потрібен новий гаманець, Hummingbot надсилає запит на ендпоінт `POST /wallet/add` до Gateway. Gateway створює та зберігає зашифрований ключ у `conf/wallets/solana/`.
3.  **Робота з пулами:** Gateway не "дізнається" про пули. Hummingbot-стратегія сама визначає, з якими пулами працювати, і надсилає запити до Gateway для отримання інформації (`/pools`, `/pool-info`) або для виконання операцій (`/swap`, `/addLiquidity`) з конкретними `poolId`.

### Чи зберігаються ці дані в локальному файлі/БД Gateway?

Так, але лише дані, що стосуються конфігурації самого Gateway:
-   **Гаманці:** Зберігаються в `conf/wallets/`.
-   **Конфігурація мереж та DEX:** Зберігається в `conf/chains/` та `conf/connectors/`.
-   **Додані пули:** Список пулів, доданих вручну, зберігається в `conf/pools/{connector}.json`.

Gateway не зберігає жодної інформації про екземпляри ботів, їхні стани чи історію операцій.

### Чи потрібно якось вручну “активувати” watch або swap маршрут для бота?

Ні, не потрібно. Усі API маршрути (ендпоінти) в Gateway є активними постійно, поки сервер запущений. Hummingbot-стратегія просто викликає потрібний ендпоінт, коли це необхідно згідно з її логікою. Немає жодного механізму "активації" чи "підписки" на рівні Gateway для конкретного бота.

## 7. Моніторинг та журнали

### Де дивитися логи свопів (успішних/невдалих)?

Усі логи записуються у файли в директорії `logs/`.
-   **Основний лог:** `logs/gateway.log`. Тут міститься інформація про всі запити, успішні транзакції (`INFO`) та помилки (`ERROR`).
-   **Лог помилок:** `logs/error.log`. Сюди дублюються лише записи з рівнем `ERROR`.

Для пошуку свопів шукайте записи, що містять `txHash` (для успішних) або повідомлення про помилки, пов'язані з `swap` (для невдалих).

### Чи є REST/WebSocket API для відслідковування подій?

-   **REST API для статусу транзакції:** Так. Ви можете відслідковувати статус транзакції, періодично опитуючи ендпоінт `POST /chains/solana/status`.
    -   **Запит:**
        ```json
        {
          "chain": "solana",
          "network": "devnet",
          "txHash": "YOUR_TRANSACTION_HASH"
        }
        ```
    -   **Відповідь:** Поверне статус (`CONFIRMED`, `PENDING`, `FAILED`) та інформацію про підтвердження.

-   **WebSocket API:** Gateway **не надає** публічного WebSocket API для клієнтів. Внутрішньо він може використовувати WebSocket для з'єднання з RPC-провайдерами (Helius, Infura), але ці з'єднання не виставляються назовні.

### Чи можна увімкнути розширене логування саме для Devnet?

Ні, налаштування рівня логування є **глобальним** для всього Gateway і не може бути встановлене для окремої мережі.

Ви можете увімкнути розширене логування для всіх операцій, змінивши параметр `logLevel` у файлі `conf/server.yml` з `info` на `debug`.

```yaml
# conf/server.yml
logLevel: debug # або 'trace' для максимальної деталізації
```
Це значно збільшить кількість логів, але надасть детальну інформацію про кожен крок виконання запиту, що корисно для налагодження. Після завершення тестів рекомендується повернути `logLevel` на `info`.

## 8. Обмеження та ресурси

### Чи потрібно попередньо додавати токени (наприклад, test111) у whitelist?

Ні, не обов'язково. Ви можете працювати з будь-яким токеном, використовуючи його **mint-адресу** в запитах до API.

-   **Використання Mint-адреси:** Більшість ендпоінтів (наприклад, для свопу або перевірки балансу) приймають безпосередньо mint-адресу токена. Це найнадійніший спосіб.
-   **Використання Символу:** Щоб звертатися до токена за його символом (наприклад, "USDC" або "TEST111"), він має бути доданий до списку токенів для відповідної мережі. Для Devnet цей файл знаходиться тут: `conf/tokens/solana_devnet.json`. Ви можете вручну відредагувати цей файл, щоб додати свої тестові токени.

### Чи є faucet/метод у Gateway для отримання Devnet-токенів?

Ні, Gateway не має вбудованого функціоналу "фосету" (faucet) для отримання тестових токенів. Gateway є лише інтерфейсом для взаємодії з блокчейном та DEX.

Щоб отримати токени на Devnet, вам потрібно:
1.  Отримати Devnet SOL через публічний фосет Solana (наприклад, за допомогою команди `solana airdrop 2 YOUR_WALLET_ADDRESS --url https://api.devnet.solana.com`).
2.  Обміняти отриманий SOL на потрібні вам тестові токени (наприклад, `test111`) на одному з DEX, використовуючи для цього API Gateway.

### Чи є внутрішні обмеження по мінімальній сумі свопу?

Сам Gateway не встановлює жодних обмежень на мінімальну чи максимальну суму обміну.

Обмеження диктуються виключно:
1.  **Протоколом DEX:** Деякі пули можуть мати мінімальні вимоги до обсягу.
2.  **Ліквідністю пулу:** Обмін дуже малої суми може бути невигідним через комісії або призвести до помилки, якщо вихідна сума буде нульовою.
3.  **Комісіями мережі Solana:** Сума операції має бути достатньою, щоб покрити транзакційні витрати.

Gateway просто передає вказану вами суму до SDK відповідного DEX.

## 9. Автоматичні маршрути/агрегація

### Чи вміє Gateway сам знаходити шлях (route) між токенами на Devnet?

Так, але це залежить від конектора, який ви використовуєте.

-   **Так, через агрегатори (routers):** Конектор **Jupiter** (`/connectors/jupiter/router/`) є агрегатором ліквідності. Ви вказуєте лише вхідний та вихідний токени (`inputToken`, `outputToken`) та суму, а Jupiter автоматично знаходить найкращий маршрут обміну через безліч пулів різних DEX.
-   **Ні, для прямих AMM/CLMM:** Коли ви працюєте з конекторами **Raydium** або **Meteora** напряму (наприклад, `/connectors/raydium/amm/swap`), ви взаємодієте з одним конкретним пулом. Тому ви повинні **вручну вказати `poolId`** (або `poolAddress`).

### Якщо є router, чи працює він для Devnet?

Так, абсолютно. Агрегатор Jupiter повністю підтримує Devnet. При виклику його ендпоінтів (`/quote`, `/swap`) ви просто вказуєте `"network": "devnet"` у тілі запиту, і Gateway звертається до API Jupiter для мережі Devnet.

## 10. Документація / Конфіг

### У якому файлі/шляху лежать devnet-конфіги?

Конфігурація для Devnet розподілена по декількох файлах за призначенням:

-   **Налаштування RPC-ендпоінту:** `conf/chains/solana/devnet.yml`
-   **Вибір RPC-провайдера для Solana (глобально):** `conf/chains/solana.yml`
-   **Список токенів для Devnet:** `conf/tokens/solana_devnet.json`
-   **Список пулів (може містити пули для різних мереж):** `conf/pools/raydium.json` (пули для devnet можна додати сюди, вказавши `"network": "devnet"`).

Загальні налаштування конекторів, що не залежать від мережі, знаходяться в `conf/connectors/`.

### Як оновити/перезавантажити Gateway після зміни конфігу?

Найпростіший і найнадійніший спосіб застосувати зміни, внесені вручну в `.yml` або `.json` файли конфігурації — це **повністю перезапустити сервер Gateway**.

Gateway зчитує всі конфігураційні файли під час свого запуску. Хоча існують API для динамічної зміни конфігурації (`POST /config/update`), вони призначені для програмних оновлень, а не для ручного редагування файлів.

### Чи є офіційний README для режиму Devnet/тестів?

Не існує окремого файлу `README` виключно для Devnet. Робота з Devnet є стандартною функціональністю Gateway.

Основна інформація для тестування розподілена по таких місцях:
-   **Головний `README.md`:** Загальний опис проєкту.
-   **`GEMINI.md`:** Детальний технічний опис архітектури, ендпоінтів та найкращих практик.
-   **Документ, який ви зараз читаєте:** `docs/hummingbot_gateway_solana.md` містить зведену інформацію саме для Devnet.
-   **Коментарі в конфігураційних файлах:** Файли в `src/templates/` містять пояснення до багатьох параметрів.

Ключова ідея полягає в тому, що Gateway не має окремого "режиму Devnet". Ви просто вказуєте `"network": "devnet"` у своїх API-запитах, щоб працювати з цією мережею.
